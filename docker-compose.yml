version: '3.5'

services:
  web_server:
    image: httpd@sha256:b19cace6539a05579c55fda6be0a873c1d2c2e7392e7c08805141f79852ab07b
    hostname: httpd-server
    container_name: httpd-server
  modsec_crs:
    image: owasp/modsecurity-crs:apache@sha256:9c20dd4756378de04c3587911efdf37c15614403c0540e008f16ca1cdbc63cba
    hostname: crs-waf
    container_name: crs-waf
    environment:
      - BACKEND=http://httpd-server
      - PARANOIA=4
      - MODSEC_AUDIT_LOG=/root/audit.log
    ports:
      - "8080:8080" 
    depends_on:
      - web_server
  nuclei:
    image: projectdiscovery/nuclei:latest@sha256:91db00989521afc6727d1dedad42b1a744fbf92a7cdc9addcca78b45bba95930
    hostname: nuclei
    container_name: nuclei
    entrypoint: nuclei -u http://crs-waf -tags xss,sqli -srd /results
    volumes:
      - ./results:/results:rw
    depends_on:
      - web_server
      - modsec_crs
