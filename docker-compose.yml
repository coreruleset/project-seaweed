version: '3.5'

services:
  web_server:
    image: httpd@sha256:36c8c79f900108f0f09fd4148ad35ade57cba0dc19d13f3d15be24ce94e6a639
    hostname: httpd-server
    container_name: httpd-server
  modsec_crs:
    image: owasp/modsecurity-crs:apache@sha256:9c20dd4756378de04c3587911efdf37c15614403c0540e008f16ca1cdbc63cba
    hostname: crs-waf
    container_name: crs-waf
    environment:
      - BACKEND=http://httpd-server
      - PARANOIA=4
      - MODSEC_AUDIT_LOG=/root/audit.log
    ports:
      - "8080:8080" 
    depends_on:
      - web_server
  nuclei:
    image: projectdiscovery/nuclei:latest@sha256:480046597f3deb47c874126c2c8ff952080b1461204f8357d0011036264711fd
    hostname: nuclei
    container_name: nuclei
    entrypoint: nuclei -u http://crs-waf -tags xss,sqli -srd /results
    volumes:
      - ./results:/results:rw
    depends_on:
      - web_server
      - modsec_crs
