version: '3.5'

services:
  web_server:
    image: httpd
    hostname: httpd-server
    container_name: httpd-server
  modsec_crs:
    image: owasp/modsecurity-crs:apache
    hostname: crs-waf
    container_name: crs-waf
    environment:
      - BACKEND=http://httpd-server
    ports:
      - "8080:80"
    depends_on:
      - web_server
  nuclei:
    image: projectdiscovery/nuclei:latest
    hostname: nuclei
    container_name: nuclei
    entrypoint: nuclei -u http://crs-waf -t /root/nuclei-templates/cves/2022/CVE-2022-26134.yaml
    depends_on:
      - web_server
      - modsec_crs